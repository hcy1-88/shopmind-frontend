<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ShopMind RAG Áü•ËØÜÂ∫ìÁÆ°ÁêÜ</title>
    
    <!-- Element Plus CSS -->
    <link rel="stylesheet" href="https://unpkg.com/element-plus@2.4.4/dist/index.css">
    
    <style>
        body {
            margin: 0;
            font-family: 'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        #app {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 36px;
            margin: 0 0 10px 0;
            font-weight: 600;
        }
        
        .header p {
            font-size: 16px;
            opacity: 0.9;
            margin: 0;
        }
        
        .main-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
            overflow: hidden;
        }
        
        .upload-section {
            padding: 30px;
            background: #f8f9fa;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .document-list {
            padding: 20px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .stat-card h3 {
            margin: 0 0 5px 0;
            font-size: 14px;
            opacity: 0.9;
        }
        
        .stat-card .number {
            font-size: 32px;
            font-weight: bold;
            margin: 0;
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }
        
        .empty-state i {
            font-size: 64px;
            color: #ddd;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="header">
            <h1>üìö ShopMind RAG Áü•ËØÜÂ∫ì</h1>
            <p>Âπ≥Âè∞ËßÑÂàôÊñáÊ°£ÁÆ°ÁêÜÁ≥ªÁªü</p>
        </div>
        
        <div class="main-card">
            <!-- ‰∏ä‰º†Âå∫Âüü -->
            <div class="upload-section">
                <el-row :gutter="20">
                    <el-col :span="16">
                        <el-upload
                            ref="uploadRef"
                            :action="uploadUrl"
                            :data="uploadData"
                            :on-success="handleUploadSuccess"
                            :on-error="handleUploadError"
                            :before-upload="beforeUpload"
                            :show-file-list="false"
                            drag
                            accept=".txt,.pdf,.docx,.doc,.md"
                        >
                            <el-icon class="el-icon--upload"><upload-filled /></el-icon>
                            <div class="el-upload__text">
                                ÊãñÊãΩÊñá‰ª∂Âà∞Ê≠§Â§ÑÊàñ <em>ÁÇπÂáª‰∏ä‰º†</em>
                            </div>
                            <template #tip>
                                <div class="el-upload__tip">
                                    ÊîØÊåÅ txt„ÄÅpdf„ÄÅdocx„ÄÅmd Ê†ºÂºèÔºåÊñá‰ª∂Â§ßÂ∞è‰∏çË∂ÖËøá 10MB
                                </div>
                            </template>
                        </el-upload>
                    </el-col>
                    <el-col :span="8">
                        <div class="stat-card">
                            <h3>ÊñáÊ°£ÊÄªÊï∞</h3>
                            <p class="number">{{ documents.length }}</p>
                        </div>
                    </el-col>
                </el-row>
            </div>
            
            <!-- ÊñáÊ°£ÂàóË°® -->
            <div class="document-list">
                <el-row style="margin-bottom: 20px;">
                    <el-col :span="12">
                        <h2 style="margin: 0;">ÊñáÊ°£ÂàóË°®</h2>
                    </el-col>
                    <el-col :span="12" style="text-align: right;">
                        <el-button 
                            type="primary" 
                            :icon="Refresh" 
                            @click="loadDocuments"
                            :loading="loading"
                        >
                            Âà∑Êñ∞
                        </el-button>
                    </el-col>
                </el-row>
                
                <!-- ÊñáÊ°£Ë°®Ê†º -->
                <el-table 
                    v-if="documents.length > 0"
                    :data="documents" 
                    style="width: 100%"
                    v-loading="loading"
                >
                    <el-table-column prop="filename" label="Êñá‰ª∂Âêç" min-width="200">
                        <template #default="scope">
                            <el-icon style="margin-right: 5px;"><document /></el-icon>
                            {{ scope.row.filename }}
                        </template>
                    </el-table-column>
                    <el-table-column prop="category" label="ÂàÜÁ±ª" width="120">
                        <template #default="scope">
                            <el-tag type="primary">{{ scope.row.category }}</el-tag>
                        </template>
                    </el-table-column>
                    <el-table-column prop="text_preview" label="ÂÜÖÂÆπÈ¢ÑËßà" min-width="300" show-overflow-tooltip />
                    <el-table-column label="Êìç‰Ωú" width="100" fixed="right">
                        <template #default="scope">
                            <el-button 
                                type="danger" 
                                size="small" 
                                :icon="Delete"
                                @click="deleteDocument(scope.row)"
                                link
                            >
                                Âà†Èô§
                            </el-button>
                        </template>
                    </el-table-column>
                </el-table>
                
                <!-- Á©∫Áä∂ÊÄÅ -->
                <div v-else class="empty-state">
                    <el-icon><folder-opened /></el-icon>
                    <p>ÊöÇÊó†ÊñáÊ°£</p>
                    <p style="font-size: 14px;">ËØ∑‰∏ä‰º†ÊñáÊ°£Âà∞Áü•ËØÜÂ∫ì</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Vue 3 -->
    <script src="https://unpkg.com/vue@3.3.11/dist/vue.global.js"></script>
    <!-- Element Plus -->
    <script src="https://unpkg.com/element-plus@2.4.4/dist/index.full.js"></script>
    <!-- Element Plus Icons -->
    <script src="https://unpkg.com/@element-plus/icons-vue@2.1.0/dist/index.iife.min.js"></script>

    <script>
        const { createApp, ref, onMounted } = Vue;
        const { ElMessage, ElMessageBox } = ElementPlus;

        // API Âü∫Á°ÄÂú∞ÂùÄ
        const API_BASE = 'http://localhost:8080/api/shopmind-ai-service';

        createApp({
            setup() {
                // Ê≥®ÂÜåÂõæÊ†á
                const { 
                    UploadFilled, 
                    Document, 
                    Delete, 
                    Refresh,
                    FolderOpened 
                } = ElementPlusIconsVue;

                // ÂìçÂ∫îÂºèÊï∞ÊçÆ
                const documents = ref([]);
                const loading = ref(false);
                const uploadRef = ref(null);
                
                const uploadUrl = `${API_BASE}/rag/upload`;
                const uploadData = ref({
                    category: 'platform_rule'
                });

                // Âä†ËΩΩÊñáÊ°£ÂàóË°®
                const loadDocuments = async () => {
                    loading.value = true;
                    try {
                        const response = await fetch(`${API_BASE}/rag/documents`);
                        const result = await response.json();
                        
                        if (result.success) {
                            documents.value = result.data || [];
                            ElMessage.success('ÊñáÊ°£ÂàóË°®Âä†ËΩΩÊàêÂäü');
                        } else {
                            ElMessage.error(result.message || 'Âä†ËΩΩÂ§±Ë¥•');
                        }
                    } catch (error) {
                        console.error('Âä†ËΩΩÊñáÊ°£Â§±Ë¥•:', error);
                        ElMessage.error('Âä†ËΩΩÊñáÊ°£Â§±Ë¥•: ' + error.message);
                    } finally {
                        loading.value = false;
                    }
                };

                // ‰∏ä‰º†ÂâçÈ™åËØÅ
                const beforeUpload = (file) => {
                    const isLt10M = file.size / 1024 / 1024 < 10;
                    if (!isLt10M) {
                        ElMessage.error('Êñá‰ª∂Â§ßÂ∞è‰∏çËÉΩË∂ÖËøá 10MB');
                        return false;
                    }
                    return true;
                };

                // ‰∏ä‰º†ÊàêÂäü
                const handleUploadSuccess = (response) => {
                    if (response.success) {
                        ElMessage.success('ÊñáÊ°£‰∏ä‰º†ÊàêÂäü');
                        loadDocuments(); // Âà∑Êñ∞ÂàóË°®
                    } else {
                        ElMessage.error(response.message || '‰∏ä‰º†Â§±Ë¥•');
                    }
                };

                // ‰∏ä‰º†Â§±Ë¥•
                const handleUploadError = (error) => {
                    console.error('‰∏ä‰º†Â§±Ë¥•:', error);
                    ElMessage.error('‰∏ä‰º†Â§±Ë¥•ÔºåËØ∑ÈáçËØï');
                };

                // Âà†Èô§ÊñáÊ°£
                const deleteDocument = async (doc) => {
                    try {
                        await ElMessageBox.confirm(
                            `Á°ÆÂÆöË¶ÅÂà†Èô§ÊñáÊ°£ "${doc.filename}" ÂêóÔºüËøôÂ∞ÜÂà†Èô§ËØ•Êñá‰ª∂ÁöÑÊâÄÊúâÂÜÖÂÆπÂùó„ÄÇ`,
                            'Á°ÆËÆ§Âà†Èô§',
                            {
                                confirmButtonText: 'Âà†Èô§',
                                cancelButtonText: 'ÂèñÊ∂à',
                                type: 'warning',
                            }
                        );

                        loading.value = true;
                        const response = await fetch(
                            `${API_BASE}/rag/documents/${encodeURIComponent(doc.filename)}`,
                            { method: 'DELETE' }
                        );
                        const result = await response.json();

                        if (result.success) {
                            ElMessage.success('ÊñáÊ°£Âà†Èô§ÊàêÂäü');
                            loadDocuments(); // Âà∑Êñ∞ÂàóË°®
                        } else {
                            ElMessage.error(result.message || 'Âà†Èô§Â§±Ë¥•');
                        }
                    } catch (error) {
                        if (error !== 'cancel') {
                            console.error('Âà†Èô§Â§±Ë¥•:', error);
                            ElMessage.error('Âà†Èô§Â§±Ë¥•: ' + error.message);
                        }
                    } finally {
                        loading.value = false;
                    }
                };

                // ÁªÑ‰ª∂ÊåÇËΩΩÊó∂Âä†ËΩΩÊï∞ÊçÆ
                onMounted(() => {
                    loadDocuments();
                });

                return {
                    documents,
                    loading,
                    uploadRef,
                    uploadUrl,
                    uploadData,
                    loadDocuments,
                    beforeUpload,
                    handleUploadSuccess,
                    handleUploadError,
                    deleteDocument,
                    // ÂõæÊ†á
                    UploadFilled,
                    Document,
                    Delete,
                    Refresh,
                    FolderOpened
                };
            }
        }).use(ElementPlus).mount('#app');
    </script>
</body>
</html>

